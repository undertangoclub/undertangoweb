<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Calendario de Tango</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        background-color: #1a0f0a;
        color: #d4a574;
        margin: 0;
        padding: 10px;
        min-height: 100vh;
        box-sizing: border-box;
      }

      .container {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        justify-content: center;
      }

      .month {
        background-color: rgba(41, 27, 23, 0.9);
        border-radius: 10px;
        padding: 15px;
        width: 100%;
        max-width: 800px;
      }

      .month-header {
        margin-bottom: 15px;
        padding: 10px;
        background: linear-gradient(rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0.4)),
          url("https://hebbkx1anhila5yf.public.blob.vercel-storage.com/11-2024-9vRUE8b2vSmqweM2I7CJw1H9gdAt6k.png");
        background-size: cover;
        background-position: center;
        border-radius: 8px;
      }

      .month-header h2 {
        color: #ffd700;
        margin: 0;
        font-size: 1.5rem;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
      }

      .calendar-grid {
        display: flex;
        flex-wrap: wrap;
      }

      .week {
        display: flex;
        width: 100%;
      }

      .weekday {
        width: 40px;
        text-align: center;
        padding: 6px;
        font-weight: bold;
        color: #ffd700;
        font-size: 0.9rem;
      }

      .days-column {
        display: flex;
        flex-direction: column;
        width: 40px;
      }

      .day {
        height: 40px;
        background-color: rgba(62, 39, 35, 0.5);
        border: 1px solid #4a2f2a;
        padding: 6px;
        cursor: pointer;
        transition: background-color 0.3s;
        overflow: hidden;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .day:hover {
        background-color: rgba(82, 49, 45, 0.7);
      }

      .day-number {
        font-weight: bold;
        font-size: 0.9rem;
      }

      .events-column {
        flex: 1;
        display: flex;
        flex-direction: column;
      }

      .event-row {
        display: flex;
        height: 40px;
        border-bottom: 1px solid #4a2f2a;
      }

      .event {
        flex: 1;
        font-size: 0.8rem;
        padding: 2px 4px;
        background-color: rgba(255, 215, 0, 0.1);
        color: #ffd700;
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
      }

      .add-event {
        margin-top: 15px;
        background-color: rgba(41, 27, 23, 0.9);
        padding: 15px;
        border-radius: 10px;
        width: 100%;
        max-width: 800px;
        box-sizing: border-box;
      }

      .add-event h3 {
        color: #ffd700;
        margin-top: 0;
        font-size: 1.2rem;
      }

      .form-group {
        margin-bottom: 10px;
      }

      .form-group label {
        display: block;
        margin-bottom: 4px;
        color: #d4a574;
        font-size: 0.9rem;
      }

      input,
      textarea {
        width: 100%;
        padding: 8px;
        background-color: rgba(62, 39, 35, 0.5);
        border: 1px solid #4a2f2a;
        color: #d4a574;
        border-radius: 4px;
        font-size: 0.9rem;
        box-sizing: border-box;
      }

      button {
        background-color: #8b4513;
        color: #ffd700;
        border: none;
        padding: 8px 16px;
        border-radius: 4px;
        cursor: pointer;
        transition: background-color 0.3s;
        font-size: 0.9rem;
      }

      button:hover {
        background-color: #a0522d;
      }

      .referencias {
        margin-top: 15px;
        position: relative;
        display: inline-block;
        cursor: pointer;
      }

      .referencias .tooltip {
        visibility: hidden;
        width: 200px;
        background-color: rgba(41, 27, 23, 0.9);
        color: #d4a574;
        text-align: left;
        border-radius: 6px;
        padding: 10px;
        position: absolute;
        z-index: 1;
        bottom: 125%;
        left: 50%;
        margin-left: -100px;
        opacity: 0;
        transition: opacity 0.3s;
      }

      .referencias:hover .tooltip {
        visibility: visible;
        opacity: 1;
      }

      @media (max-width: 768px) {
        .month,
        .add-event {
          padding: 10px;
        }

        .weekday,
        .day {
          width: 30px;
          height: 30px;
          font-size: 0.8rem;
        }

        .event {
          font-size: 0.7rem;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- Noviembre -->
      <div class="month">
        <div class="month-header">
          <h2>Noviembre 2024</h2>
        </div>
        <div class="calendar-grid">
          <div class="days-column">
            <div class="weekday">Dom</div>
            <div class="weekday">Lun</div>
            <div class="weekday">Mar</div>
            <div class="weekday">Mié</div>
            <div class="weekday">Jue</div>
            <div class="weekday">Vie</div>
            <div class="weekday">Sáb</div>
          </div>
          <div class="events-column">
            <!-- Las semanas se generarán dinámicamente aquí -->
          </div>
        </div>
      </div>

      <!-- Diciembre -->
      <div class="month">
        <div class="month-header">
          <h2>Diciembre 2024</h2>
        </div>
        <div class="calendar-grid">
          <div class="days-column">
            <div class="weekday">Dom</div>
            <div class="weekday">Lun</div>
            <div class="weekday">Mar</div>
            <div class="weekday">Mié</div>
            <div class="weekday">Jue</div>
            <div class="weekday">Vie</div>
            <div class="weekday">Sáb</div>
          </div>
          <div class="events-column">
            <!-- Las semanas se generarán dinámicamente aquí -->
          </div>
        </div>
      </div>
    </div>

    <div class="add-event">
      <h3>Agregar Evento</h3>
      <div class="form-group">
        <label for="eventDate">Fecha:</label>
        <input type="date" id="eventDate" />
      </div>
      <div class="form-group">
        <label for="eventTime">Hora:</label>
        <input type="time" id="eventTime" />
      </div>
      <div class="form-group">
        <label for="eventDescription">Descripción:</label>
        <textarea id="eventDescription" rows="3"></textarea>
      </div>
      <button onclick="addEvent()">Agregar Evento</button>
    </div>

    <div class="referencias">
      Referencias
      <span class="tooltip">
        �� = Bianca y Pablo<br />
        TyM = Tiki y Meli<br />
        YyD = Yesi y Dennis<br />
        x2 = doble turno<br />
        Cr = Cruceros<br />
        CM = Casa Malbec<br />
        DAM = DAM
      </span>
    </div>

    <script>
      const AIRTABLE_API_KEY =
        "pato81fvPnkEuWh3z.106e22ccb41bfad6205fed18c2ac2e509a026e20071c0420b94e3dd1da5d7764";
      const BASE_ID = "appPGVN4sDJ0aTrSb";
      const TABLE_NAME = "calendario";

      function createCalendarDays(eventsColumn, year, month) {
        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);
        const totalDays = lastDay.getDate();
        const startingDay = firstDay.getDay();

        let currentWeek = document.createElement("div");
        currentWeek.className = "week";

        // Añadir días vacíos al principio si es necesario
        for (let i = 0; i < startingDay; i++) {
          const emptyDay = document.createElement("div");
          emptyDay.className = "event-row";
          currentWeek.appendChild(emptyDay);
        }

        for (let day = 1; day <= totalDays; day++) {
          const eventRow = document.createElement("div");
          eventRow.className = "event-row";
          eventRow.innerHTML = `<div class="day"><span class="day-number">${day}</span></div>`;
          currentWeek.appendChild(eventRow);

          if ((startingDay + day) % 7 === 0 || day === totalDays) {
            eventsColumn.appendChild(currentWeek);
            currentWeek = document.createElement("div");
            currentWeek.className = "week";
          }
        }

        // Añadir días vacíos al final si es necesario
        while (
          currentWeek.children.length < 7 &&
          currentWeek.children.length > 0
        ) {
          const emptyDay = document.createElement("div");
          emptyDay.className = "event-row";
          currentWeek.appendChild(emptyDay);
        }

        if (currentWeek.children.length > 0) {
          eventsColumn.appendChild(currentWeek);
        }
      }

      function initializeCalendars() {
        const novemberEventsColumn = document.querySelector(
          ".month:first-child .events-column"
        );
        const decemberEventsColumn = document.querySelector(
          ".month:last-child .events-column"
        );

        createCalendarDays(novemberEventsColumn, 2024, 10); // 10 = Noviembre (0-based)
        createCalendarDays(decemberEventsColumn, 2024, 11); // 11 = Diciembre (0-based)
      }

      async function loadEvents() {
        try {
          const response = await fetch(
            `https://api.airtable.com/v0/${BASE_ID}/${TABLE_NAME}`,
            {
              headers: {
                Authorization: `Bearer ${AIRTABLE_API_KEY}`,
                "Content-Type": "application/json",
              },
            }
          );

          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          const data = await response.json();
          displayEvents(data.records);
        } catch (error) {
          console.error("Error loading events:", error);
        }
      }

      function displayEvents(records) {
        records.forEach((record) => {
          const date = new Date(record.fields.fecha);
          const month = date.getMonth();
          const day = date.getDate();
          const monthIndex = month - 10; // 0 para Noviembre, 1 para Diciembre

          const monthContainers = document.querySelectorAll(".month");
          if (monthIndex >= 0 && monthIndex < 2) {
            const eventRows =
              monthContainers[monthIndex].querySelectorAll(".event-row");
            const eventRow = eventRows[day - 1]; // -1 porque los días empiezan en 1

            if (eventRow) {
              const eventDiv = document.createElement("div");
              eventDiv.className = "event";
              eventDiv.textContent = record.fields.Evento;
              eventRow.appendChild(eventDiv);
            }
          }
        });
      }

      async function addEvent() {
        const date = document.getElementById("eventDate").value;
        const time = document.getElementById("eventTime").value;
        const description = document.getElementById("eventDescription").value;

        if (!date || !time || !description) {
          alert("Por favor complete todos los campos");
          return;
        }

        try {
          const response = await fetch(
            `https://api.airtable.com/v0/${BASE_ID}/${TABLE_NAME}`,
            {
              method: "POST",
              headers: {
                Authorization: `Bearer ${AIRTABLE_API_KEY}`,
                "Content-Type": "application/json",
              },
              body: JSON.stringify({
                records: [
                  {
                    fields: {
                      fecha: `${date}T${time}:00.000Z`,
                      Evento: description,
                    },
                  },
                ],
              }),
            }
          );

          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          // Refrescar calendarios
          initializeCalendars();
          loadEvents();

          // Limpiar formulario
          document.getElementById("eventDate").value = "";
          document.getElementById("eventTime").value = "";
          document.getElementById("eventDescription").value = "";

          alert("Evento agregado exitosamente");
        } catch (error) {
          console.error("Error adding event:", error);
          alert("Error al agregar el evento");
        }
      }

      // Inicializar al cargar la página
      document.addEventListener("DOMContentLoaded", () => {
        initializeCalendars();
        loadEvents();
      });
    </script>
  </body>
</html>
