<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gestor de Tareas</title>
    <link
      href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Arial", sans-serif;
        background-color: #f0f4f8;
      }
      #root {
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background-color: white;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        border-radius: 8px;
        margin-top: 20px;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <script type="text/babel">
      const TaskManager = () => {
        const [tasks, setTasks] = React.useState([]);
        const [archivedTasks, setArchivedTasks] = React.useState([]);
        const [newTaskName, setNewTaskName] = React.useState("");
        const [showArchived, setShowArchived] = React.useState(false);
        const [openMenuId, setOpenMenuId] = React.useState(null);

        React.useEffect(() => {
          const storedTasks = localStorage.getItem("tasks");
          const storedArchivedTasks = localStorage.getItem("archivedTasks");
          if (storedTasks) {
            setTasks(JSON.parse(storedTasks));
          }
          if (storedArchivedTasks) {
            setArchivedTasks(JSON.parse(storedArchivedTasks));
          }
        }, []);

        React.useEffect(() => {
          localStorage.setItem("tasks", JSON.stringify(tasks));
          localStorage.setItem("archivedTasks", JSON.stringify(archivedTasks));
        }, [tasks, archivedTasks]);

        const addTask = () => {
          if (newTaskName.trim()) {
            const newTask = {
              id: Date.now().toString(),
              name: newTaskName,
              subTasks: [],
            };
            setTasks([...tasks, newTask]);
            setNewTaskName("");
          }
        };

        const archiveTask = (id) => {
          const taskToArchive = tasks.find((task) => task.id === id);
          setArchivedTasks([...archivedTasks, taskToArchive]);
          setTasks(tasks.filter((task) => task.id !== id));
          setOpenMenuId(null);
        };

        const restoreTask = (id) => {
          const taskToRestore = archivedTasks.find((task) => task.id === id);
          setTasks([...tasks, taskToRestore]);
          setArchivedTasks(archivedTasks.filter((task) => task.id !== id));
        };

        const deleteArchivedTask = (id) => {
          setArchivedTasks(archivedTasks.filter((task) => task.id !== id));
        };

        const addSubTask = (taskId, subTaskName) => {
          setTasks(
            tasks.map((task) =>
              task.id === taskId
                ? {
                    ...task,
                    subTasks: [
                      ...task.subTasks,
                      {
                        id: Date.now().toString(),
                        name: subTaskName,
                        completed: false,
                      },
                    ],
                  }
                : task
            )
          );
        };

        const toggleSubTask = (taskId, subTaskId) => {
          setTasks(
            tasks.map((task) =>
              task.id === taskId
                ? {
                    ...task,
                    subTasks: task.subTasks.map((subTask) =>
                      subTask.id === subTaskId
                        ? { ...subTask, completed: !subTask.completed }
                        : subTask
                    ),
                  }
                : task
            )
          );
        };

        const toggleMenu = (id) => {
          setOpenMenuId(openMenuId === id ? null : id);
        };

        return (
          <div className="container mx-auto p-4">
            <h1 className="text-2xl font-bold mb-4">Gestor de Tareas</h1>
            <div className="flex mb-4">
              <input
                type="text"
                value={newTaskName}
                onChange={(e) => setNewTaskName(e.target.value)}
                placeholder="Nueva tarea"
                className="border p-2 mr-2 flex-grow"
              />
              <button
                onClick={addTask}
                className="bg-blue-500 text-white px-4 py-2 rounded"
              >
                Agregar Tarea
              </button>
            </div>
            <div className="space-y-4">
              {tasks.map((task) => (
                <div key={task.id} className="border p-4 rounded">
                  <div className="flex justify-between items-center mb-2">
                    <h2 className="text-xl font-semibold">{task.name}</h2>
                    <div className="relative">
                      <button
                        onClick={() => toggleMenu(task.id)}
                        className="w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center focus:outline-none hover:bg-gray-300"
                        aria-label="Opciones de tarea"
                      >
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          className="h-6 w-6 text-gray-600"
                          fill="none"
                          viewBox="0 0 24 24"
                          stroke="currentColor"
                        >
                          <path
                            strokeLinecap="round"
                            strokeLinejoin="round"
                            strokeWidth={2}
                            d="M5 12h.01M12 12h.01M19 12h.01M6 12a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0z"
                          />
                        </svg>
                      </button>
                      {openMenuId === task.id && (
                        <div className="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg z-10">
                          <button
                            onClick={() => archiveTask(task.id)}
                            className="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
                          >
                            Archivar
                          </button>
                        </div>
                      )}
                    </div>
                  </div>
                  <div className="mb-2">
                    <h3 className="font-medium">Sub-tareas:</h3>
                    {task.subTasks.map((subTask) => (
                      <div key={subTask.id} className="flex items-center">
                        <input
                          type="checkbox"
                          checked={subTask.completed}
                          onChange={() => toggleSubTask(task.id, subTask.id)}
                          className="mr-2"
                        />
                        <span>{subTask.name}</span>
                      </div>
                    ))}
                  </div>
                  <div className="flex">
                    <input
                      type="text"
                      placeholder="Nueva sub-tarea"
                      onKeyPress={(e) => {
                        if (e.key === "Enter") {
                          addSubTask(task.id, e.target.value);
                          e.target.value = "";
                        }
                      }}
                      className="border p-2 mr-2 flex-grow"
                    />
                  </div>
                </div>
              ))}
            </div>
            <div className="mt-8">
              <button
                onClick={() => setShowArchived(!showArchived)}
                className="bg-gray-500 text-white px-4 py-2 rounded mb-4"
              >
                {showArchived
                  ? "Ocultar Tareas Archivadas"
                  : "Mostrar Tareas Archivadas"}
              </button>
              {showArchived && (
                <div className="space-y-4">
                  <h2 className="text-xl font-bold">Tareas Archivadas</h2>
                  {archivedTasks.map((task) => (
                    <div
                      key={task.id}
                      className="border p-4 rounded bg-gray-100"
                    >
                      <h3 className="text-lg font-semibold mb-2">
                        {task.name}
                      </h3>
                      <div className="flex">
                        <button
                          onClick={() => restoreTask(task.id)}
                          className="bg-green-500 text-white px-4 py-2 rounded mr-2"
                        >
                          Restaurar
                        </button>
                        <button
                          onClick={() => deleteArchivedTask(task.id)}
                          className="bg-red-500 text-white px-4 py-2 rounded"
                        >
                          Eliminar Permanentemente
                        </button>
                      </div>
                    </div>
                  ))}
                </div>
              )}
            </div>
          </div>
        );
      };

      ReactDOM.render(
        <React.StrictMode>
          <TaskManager />
        </React.StrictMode>,
        document.getElementById("root")
      );
    </script>
  </body>
</html>
